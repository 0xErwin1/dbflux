name: Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v0.1.0)'
        required: true
        type: string
      sign:
        description: 'Sign artifacts (GPG)'
        required: false
        type: boolean
        default: false

permissions:
  contents: write

env:
  FEATURES: "sqlite,postgres,mysql,mongodb,redis"

jobs:
  build-linux:
    name: Build Linux ${{ matrix.arch }}
    runs-on: ${{ matrix.runs_on }}

    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: amd64
            runs_on: ubuntu-latest
            target: x86_64-unknown-linux-gnu
          - arch: arm64
            runs_on: ubuntu-24.04-arm
            target: aarch64-unknown-linux-gnu

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: ${{ matrix.target }}
          components: rust-src

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            pkg-config \
            libssl-dev \
            libdbus-1-dev \
            libxkbcommon-dev \
            libxkbcommon-x11-dev

          if apt-cache show libfuse2 >/dev/null 2>&1; then
            sudo apt-get install -y libfuse2
          else
            sudo apt-get install -y libfuse2t64
          fi

      - name: Setup Rust cache
        uses: Swatinem/rust-cache@v2
        with:
          prefix-key: "v0-rust"
          shared-key: linux-${{ matrix.arch }}
          cache-targets: true
          cache-on-failure: true

      - name: Build DBFlux
        run: cargo build --release --features "$FEATURES" --target ${{ matrix.target }}

      - name: Create package
        run: |
          mkdir -p pkg/resources/icons
          mkdir -p pkg/resources/desktop
          mkdir -p pkg/resources/mime
          mkdir -p pkg/scripts

          cp target/${{ matrix.target }}/release/dbflux pkg/dbflux
          chmod +x pkg/dbflux

          cp resources/icons/dbflux.svg pkg/resources/icons/
          cp resources/desktop/dbflux.desktop pkg/resources/desktop/
          cp resources/mime/dbflux-sql.xml pkg/resources/mime/

          cp scripts/install.sh pkg/scripts/
          cp scripts/uninstall.sh pkg/scripts/
          chmod +x pkg/scripts/*.sh

      - name: Create tar archive
        run: |
          cd pkg
          tar -czf ../dbflux-linux-${{ matrix.arch }}.tar.gz .

      - name: Generate checksum
        run: sha256sum dbflux-linux-${{ matrix.arch }}.tar.gz > dbflux-linux-${{ matrix.arch }}.tar.gz.sha256

      - name: Download appimagetool
        run: |
          ARCH=$(echo "${{ matrix.arch }}" | sed 's/amd64/x86_64/' | sed 's/arm64/aarch64/')
          curl -LO https://github.com/AppImage/appimagetool/releases/download/continuous/appimagetool-${ARCH}.AppImage
          chmod +x appimagetool-${ARCH}.AppImage
          echo "APPIMAGE_ARCH=$ARCH" >> $GITHUB_ENV

      - name: Create AppImage
        run: |
          VERSION="${GITHUB_REF_NAME#v}"
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            VERSION="${{ github.event.inputs.version }}"
            VERSION="${VERSION#v}"
          fi

          mkdir -p AppDir/usr/bin
          mkdir -p AppDir/usr/share/applications
          mkdir -p AppDir/usr/share/icons/hicolor/scalable/apps
          mkdir -p AppDir/usr/share/mime/packages

          cp target/${{ matrix.target }}/release/dbflux AppDir/usr/bin/
          chmod +x AppDir/usr/bin/dbflux

          cp resources/desktop/dbflux.desktop AppDir/usr/share/applications/
          sed -i 's|@EXEC_PATH@|dbflux|g' AppDir/usr/share/applications/dbflux.desktop

          cp resources/icons/dbflux.svg AppDir/usr/share/icons/hicolor/scalable/apps/

          cp resources/mime/dbflux-sql.xml AppDir/usr/share/mime/packages/

          ln -sf usr/bin/dbflux AppDir/AppRun
          ln -sf usr/share/applications/dbflux.desktop AppDir/dbflux.desktop
          ln -sf usr/share/icons/hicolor/scalable/apps/dbflux.svg AppDir/dbflux.svg

          APPIMAGE_EXTRACT_AND_RUN=1 VERSION="$VERSION" ./appimagetool-${{ env.APPIMAGE_ARCH }}.AppImage AppDir

          APPIMAGE_FILE=$(find . -maxdepth 1 -name "*.AppImage" ! -name "appimagetool-*.AppImage" | head -n 1)
          if [ -z "$APPIMAGE_FILE" ]; then
            echo "AppImage output not found"
            exit 1
          fi

          mv "$APPIMAGE_FILE" dbflux-linux-${{ matrix.arch }}.AppImage

      - name: Generate AppImage checksum
        run: sha256sum dbflux-linux-${{ matrix.arch }}.AppImage > dbflux-linux-${{ matrix.arch }}.AppImage.sha256

      - name: Import GPG key
        if: github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: crazy-max/ghaction-import-gpg@v6
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}

      - name: Sign artifacts
        if: github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        run: |
          gpg --armor --detach-sign dbflux-linux-${{ matrix.arch }}.tar.gz
          gpg --armor --detach-sign dbflux-linux-${{ matrix.arch }}.tar.gz.sha256
          gpg --armor --detach-sign dbflux-linux-${{ matrix.arch }}.AppImage
          gpg --armor --detach-sign dbflux-linux-${{ matrix.arch }}.AppImage.sha256

      - name: Upload artifacts
        if: env.ACT != 'true'
        uses: actions/upload-artifact@v4
        with:
          name: linux-${{ matrix.arch }}
          path: |
            dbflux-linux-${{ matrix.arch }}.tar.gz
            dbflux-linux-${{ matrix.arch }}.tar.gz.sha256
            dbflux-linux-${{ matrix.arch }}.AppImage
            dbflux-linux-${{ matrix.arch }}.AppImage.sha256
          retention-days: 90

      - name: Upload signatures
        if: env.ACT != 'true' && github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: linux-${{ matrix.arch }}-signatures
          path: |
            dbflux-linux-${{ matrix.arch }}.tar.gz.asc
            dbflux-linux-${{ matrix.arch }}.tar.gz.sha256.asc
            dbflux-linux-${{ matrix.arch }}.AppImage.asc
            dbflux-linux-${{ matrix.arch }}.AppImage.sha256.asc
          retention-days: 90

      - name: (act) Store artifacts locally
        if: env.ACT == 'true'
        run: |
          mkdir -p /tmp/artifacts/linux-${{ matrix.arch }}
          cp dbflux-linux-${{ matrix.arch }}.tar.gz /tmp/artifacts/linux-${{ matrix.arch }}/
          cp dbflux-linux-${{ matrix.arch }}.tar.gz.sha256 /tmp/artifacts/linux-${{ matrix.arch }}/
          cp dbflux-linux-${{ matrix.arch }}.AppImage /tmp/artifacts/linux-${{ matrix.arch }}/
          cp dbflux-linux-${{ matrix.arch }}.AppImage.sha256 /tmp/artifacts/linux-${{ matrix.arch }}/
          if [ -f dbflux-linux-${{ matrix.arch }}.tar.gz.asc ]; then
            cp dbflux-linux-${{ matrix.arch }}.tar.gz.asc /tmp/artifacts/linux-${{ matrix.arch }}/
            cp dbflux-linux-${{ matrix.arch }}.AppImage.asc /tmp/artifacts/linux-${{ matrix.arch }}/
          fi

  build-macos:
    name: Build macOS ${{ matrix.arch }}
    runs-on: ${{ matrix.runs_on }}

    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: amd64
            runs_on: macos-15-large
            target: x86_64-apple-darwin
          - arch: arm64
            runs_on: macos-14
            target: aarch64-apple-darwin

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: ${{ matrix.target }}
          components: rust-src

      - name: Setup Rust cache
        uses: Swatinem/rust-cache@v2
        with:
          prefix-key: "v0-rust"
          shared-key: macos-${{ matrix.arch }}
          cache-targets: true
          cache-on-failure: true

      - name: Build DBFlux
        run: cargo build --release --features "$FEATURES" --target ${{ matrix.target }}

      - name: Create app bundle
        run: |
          VERSION="${GITHUB_REF_NAME#v}"
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            VERSION="${{ github.event.inputs.version }}"
            VERSION="${VERSION#v}"
          fi

          mkdir -p DBFlux.app/Contents/MacOS
          mkdir -p DBFlux.app/Contents/Resources

          cp target/${{ matrix.target }}/release/dbflux DBFlux.app/Contents/MacOS/
          chmod +x DBFlux.app/Contents/MacOS/dbflux

          cp resources/icons/dbflux.svg DBFlux.app/Contents/Resources/

          sed -e "s/\${VERSION}/$VERSION/g" resources/macos/Info.plist > DBFlux.app/Contents/Info.plist

          chmod +x DBFlux.app/Contents/MacOS/dbflux

      - name: Install create-dmg
        run: brew install create-dmg

      - name: Create DMG
        run: |
          VERSION="${GITHUB_REF_NAME#v}"
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            VERSION="${{ github.event.inputs.version }}"
            VERSION="${VERSION#v}"
          fi

          create-dmg \
            --volname "DBFlux" \
            --window-pos 200 120 \
            --window-size 800 450 \
            --icon-size 100 \
            --icon "DBFlux.app" 200 190 \
            --hide-extension "DBFlux.app" \
            --app-drop-link 600 185 \
            --skip-jenkins \
            dbflux-macos-${{ matrix.arch }}.dmg \
            DBFlux.app

      - name: Generate checksum
        run: shasum -a 256 dbflux-macos-${{ matrix.arch }}.dmg > dbflux-macos-${{ matrix.arch }}.dmg.sha256

      - name: Import GPG key
        if: github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: crazy-max/ghaction-import-gpg@v6
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}

      - name: Sign artifacts
        if: github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        run: |
          gpg --armor --detach-sign dbflux-macos-${{ matrix.arch }}.dmg
          gpg --armor --detach-sign dbflux-macos-${{ matrix.arch }}.dmg.sha256

      - name: Upload artifacts
        if: env.ACT != 'true'
        uses: actions/upload-artifact@v4
        with:
          name: macos-${{ matrix.arch }}
          path: |
            dbflux-macos-${{ matrix.arch }}.dmg
            dbflux-macos-${{ matrix.arch }}.dmg.sha256
          retention-days: 90

      - name: Upload signatures
        if: env.ACT != 'true' && github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: macos-${{ matrix.arch }}-signatures
          path: |
            dbflux-macos-${{ matrix.arch }}.dmg.asc
            dbflux-macos-${{ matrix.arch }}.dmg.sha256.asc
          retention-days: 90

      - name: (act) Store artifacts locally
        if: env.ACT == 'true'
        run: |
          mkdir -p /tmp/artifacts/macos-${{ matrix.arch }}
          cp dbflux-macos-${{ matrix.arch }}.dmg /tmp/artifacts/macos-${{ matrix.arch }}/
          cp dbflux-macos-${{ matrix.arch }}.dmg.sha256 /tmp/artifacts/macos-${{ matrix.arch }}/
          if [ -f dbflux-macos-${{ matrix.arch }}.dmg.asc ]; then
            cp dbflux-macos-${{ matrix.arch }}.dmg.asc /tmp/artifacts/macos-${{ matrix.arch }}/
          fi

  build-windows:
    name: Build Windows amd64
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: x86_64-pc-windows-msvc
          components: rust-src

      - name: Setup Rust cache
        uses: Swatinem/rust-cache@v2
        with:
          prefix-key: "v0-rust"
          shared-key: windows-amd64
          cache-targets: true
          cache-on-failure: true

      - name: Build DBFlux
        run: cargo build --release --features "$env:FEATURES" --target x86_64-pc-windows-msvc

      - name: Install ImageMagick
        run: choco install imagemagick -y

      - name: Create ICO from SVG
        run: |
          magick convert -background none -resize 256x256 resources/icons/dbflux.svg dbflux-256.png
          magick convert -background none -resize 128x128 resources/icons/dbflux.svg dbflux-128.png
          magick convert -background none -resize 64x64 resources/icons/dbflux.svg dbflux-64.png
          magick convert -background none -resize 48x48 resources/icons/dbflux.svg dbflux-48.png
          magick convert -background none -resize 32x32 resources/icons/dbflux.svg dbflux-32.png
          magick convert -background none -resize 16x16 resources/icons/dbflux.svg dbflux-16.png
          magick convert dbflux-16.png dbflux-32.png dbflux-48.png dbflux-64.png dbflux-128.png dbflux-256.png dbflux.ico

      - name: Create portable package
        run: |
          New-Item -Path pkg -ItemType Directory -Force | Out-Null
          Copy-Item target/x86_64-pc-windows-msvc/release/dbflux.exe pkg/dbflux.exe
          Copy-Item dbflux.ico pkg/dbflux.ico
          Compress-Archive -Path pkg/* -DestinationPath dbflux-windows-amd64.zip -Force

      - name: Generate ZIP checksum
        run: |
          $hash = (Get-FileHash -Algorithm SHA256 dbflux-windows-amd64.zip).Hash.ToLower()
          "$hash  dbflux-windows-amd64.zip" | Out-File -FilePath dbflux-windows-amd64.zip.sha256 -Encoding ascii

      - name: Prepare installer files
        run: |
          New-Item -Path installer -ItemType Directory -Force | Out-Null
          Copy-Item target/x86_64-pc-windows-msvc/release/dbflux.exe installer/dbflux.exe
          Copy-Item dbflux.ico installer/dbflux.ico
          Copy-Item resources/windows/installer.iss installer/installer.iss
          Copy-Item LICENSE installer/LICENSE

      - name: Get version
        id: version
        shell: pwsh
        run: |
          if ("${{ github.event_name }}" -eq "workflow_dispatch") {
            $version = "${{ github.event.inputs.version }}"
          else
            $version = "$env:GITHUB_REF_NAME"
          }

          $version = $version.TrimStart('v')
          "version=$version" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8

      - name: Build installer
        uses: Minionguyjpro/Inno-Setup-Action@v1.2.2
        with:
          path: installer/installer.iss
          options: /DMyAppVersion=${{ steps.version.outputs.version }} /O+

      - name: Generate installer checksum
        run: |
          $hash = (Get-FileHash -Algorithm SHA256 installer/output/dbflux-windows-amd64-setup.exe).Hash.ToLower()
          "$hash  dbflux-windows-amd64-setup.exe" | Out-File -FilePath dbflux-windows-amd64-setup.exe.sha256 -Encoding ascii

      - name: Move installer
        run: Move-Item installer/output/dbflux-windows-amd64-setup.exe dbflux-windows-amd64-setup.exe -Force

      - name: Import GPG key
        if: github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: crazy-max/ghaction-import-gpg@v6
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}

      - name: Sign artifacts
        if: github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        run: |
          gpg --armor --detach-sign dbflux-windows-amd64.zip
          gpg --armor --detach-sign dbflux-windows-amd64.zip.sha256
          gpg --armor --detach-sign dbflux-windows-amd64-setup.exe
          gpg --armor --detach-sign dbflux-windows-amd64-setup.exe.sha256

      - name: Upload artifacts
        if: env.ACT != 'true'
        uses: actions/upload-artifact@v4
        with:
          name: windows-amd64
          path: |
            dbflux-windows-amd64.zip
            dbflux-windows-amd64.zip.sha256
            dbflux-windows-amd64-setup.exe
            dbflux-windows-amd64-setup.exe.sha256
          retention-days: 90

      - name: Upload signatures
        if: env.ACT != 'true' && github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: windows-amd64-signatures
          path: |
            dbflux-windows-amd64.zip.asc
            dbflux-windows-amd64.zip.sha256.asc
            dbflux-windows-amd64-setup.exe.asc
            dbflux-windows-amd64-setup.exe.sha256.asc
          retention-days: 90

      - name: (act) Store artifacts locally
        if: env.ACT == 'true'
        shell: pwsh
        run: |
          New-Item -Path C:\tmp\artifacts\windows-amd64 -ItemType Directory -Force | Out-Null
          Copy-Item dbflux-windows-amd64.zip C:\tmp\artifacts\windows-amd64\
          Copy-Item dbflux-windows-amd64.zip.sha256 C:\tmp\artifacts\windows-amd64\
          Copy-Item dbflux-windows-amd64-setup.exe C:\tmp\artifacts\windows-amd64\
          Copy-Item dbflux-windows-amd64-setup.exe.sha256 C:\tmp\artifacts\windows-amd64\
          if (Test-Path dbflux-windows-amd64.zip.asc) {
            Copy-Item dbflux-windows-amd64.zip.asc C:\tmp\artifacts\windows-amd64\
            Copy-Item dbflux-windows-amd64-setup.exe.asc C:\tmp\artifacts\windows-amd64\
          }

  release:
    name: Create Release
    needs: [build-linux, build-macos, build-windows]
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Download all artifacts
        if: env.ACT != 'true'
        uses: actions/download-artifact@v4
        with:
          path: artifacts
          pattern: "*"
          merge-multiple: false

      - name: (act) Load artifacts locally
        if: env.ACT == 'true'
        run: |
          mkdir -p artifacts
          cp -r /tmp/artifacts/* artifacts/
          ls -R artifacts

      - name: Get version
        id: version
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "version=${{ github.event.inputs.version }}" >> $GITHUB_OUTPUT
          else
            echo "version=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          fi

      - name: Get previous tag
        id: prev_tag
        run: |
          PREV_TAG=$(git describe --tags --abbrev=0 HEAD^ 2>/dev/null || echo "")
          echo "tag=$PREV_TAG" >> $GITHUB_OUTPUT

      - name: Ensure gh CLI
        if: env.ACT != 'true'
        run: |
          if ! gh --version; then
            sudo apt-get update
            sudo apt-get install -y gh
          fi

      - name: Generate release notes
        id: notes
        if: env.ACT != 'true' && steps.prev_tag.outputs.tag != ''
        run: |
          gh api \
            repos/${{ github.repository }}/releases/generate-notes \
            -f tag_name=${{ steps.version.outputs.version }} \
            -f previous_tag_name=${{ steps.prev_tag.outputs.tag }} \
            --jq .body > auto_notes.md
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Compose release body
        run: |
          cat > release_body.md << 'EOF'
          ## Installation

          ### Linux

          #### Tarball (recommended)
          ```bash
          # Download and extract (replace amd64 with arm64 for ARM)
          wget https://github.com/${{ github.repository }}/releases/download/${{ steps.version.outputs.version }}/dbflux-linux-amd64.tar.gz
          tar -xzf dbflux-linux-amd64.tar.gz

          # Run installer
          sudo ./scripts/install.sh
          ```

          #### AppImage (portable)
          ```bash
          # Download
          wget https://github.com/${{ github.repository }}/releases/download/${{ steps.version.outputs.version }}/dbflux-linux-amd64.AppImage
          chmod +x dbflux-linux-amd64.AppImage
          ./dbflux-linux-amd64.AppImage
          ```

          ### macOS

          DBFlux for macOS is not signed with an Apple developer certificate. When opening for the first time:

          1. Download the DMG for your architecture:
             - **Intel Macs**: `dbflux-macos-amd64.dmg`
             - **Apple Silicon (M1/M2/M3)**: `dbflux-macos-arm64.dmg`
          2. Open the DMG and drag DBFlux to Applications
          3. When you see "unidentified developer", go to **System Preferences → Privacy & Security**
          4. Click **Open Anyway** next to the warning
          5. Confirm you want to open the application

          Alternatively, from Terminal:
          ```bash
          xattr -cr /Applications/DBFlux.app
          ```

          ### Windows

          #### Installer
          1. Download `dbflux-windows-amd64-setup.exe`
          2. Run the installer and follow the wizard

          #### Portable
          1. Download `dbflux-windows-amd64.zip`
          2. Extract and run `dbflux.exe`

          > Note: The executable is not signed. Windows SmartScreen may show a warning. Click "More info" → "Run anyway".

          ---

          ### Verify Downloads

          Releases triggered with `workflow_dispatch` and `sign=true` include GPG signatures (key `A614B7D25134987A`).

          ```bash
          # Import the public key (one time)
          gpg --keyserver keyserver.ubuntu.com --recv-keys A614B7D25134987A

          # Verify checksum
          sha256sum -c dbflux-linux-amd64.tar.gz.sha256

          # Verify GPG signature (if signed)
          gpg --verify dbflux-linux-amd64.tar.gz.asc dbflux-linux-amd64.tar.gz
          ```

          ### System Requirements

          | Platform | Requirements |
          |----------|-------------|
          | Linux | x86_64 or ARM64, Vulkan-capable GPU (recommended) |
          | macOS | macOS 11.0 (Big Sur) or later |
          | Windows | Windows 10 or later, x86_64 |

          ---

          EOF

          if [ -f auto_notes.md ]; then
            cat auto_notes.md >> release_body.md
          else
            echo "## What's Changed" >> release_body.md
            echo "" >> release_body.md
            echo "Initial release or no previous tag found." >> release_body.md
          fi

      - name: Create release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.version.outputs.version }}
          name: DBFlux ${{ steps.version.outputs.version }}
          body_path: release_body.md
          files: |
            artifacts/linux-*/*.tar.gz
            artifacts/linux-*/*.tar.gz.sha256
            artifacts/linux-*/*.AppImage
            artifacts/linux-*/*.AppImage.sha256
            artifacts/macos-*/*.dmg
            artifacts/macos-*/*.dmg.sha256
            artifacts/windows-*/*.zip
            artifacts/windows-*/*.zip.sha256
            artifacts/windows-*/*-setup.exe
            artifacts/windows-*/*-setup.exe.sha256
          draft: true
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload signatures to release
        if: env.ACT != 'true' && github.event_name == 'workflow_dispatch' && github.event.inputs.sign == 'true'
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.version.outputs.version }}
          files: |
            artifacts/*/*.asc
          draft: true
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
